<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ Hàng</title>
    <link href="~/Content/Css/CartStyleSheet.css" rel="stylesheet">
    @{
        Layout = "~/Views/Shared/nav.cshtml";
    }
</head>

<body>
    <span>@ViewBag.id</span>

    <main class="container">
        <div class="go-home-btn" style="margin-bottom: 20px; text-align: center;">
            <button onclick="window.location='@Url.Action("Index", "Home")'"
                    style="padding: 10px 20px; font-size: 16px; background-color: #FF6918; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold">
                Quay về Trang Chủ
            </button>
        </div>

        <div class="cart-container">
            <div class="cart-list">
                @if (ViewBag.list != null && ViewBag.list.Count > 0)
                {
                    foreach (var gh in ViewBag.list)
                    {
                        <div class="cart-items" style="border: 2px solid #FFB38E; background-color: #FFF1DB; margin-bottom: 15px; display: flex; align-items: center; position: relative;">
                            <a href="~/Home/XoaGH?id=@gh[1]" class="btn-remove" style="text-decoration:none;position: absolute; top: 10px; right: 10px; background: none; border: none; cursor: pointer; color: #000; font-size: 2em; font-weight: bold; padding: 10px;">
                                &times;
                            </a>

                            <img src="~/Content/Picture/@gh[7]" class="img-product" alt="" style="width: 120px; height: auto;" />

                            <div class="cart-item-info" style="flex-grow: 1; margin-left: 20px;">
                                <h2 style="font-size: 1.2em;">@gh[5]</h2>
                                <div class="sizes">
                                    <div class="size" data-size="@gh[4]" style="background-color: #FF6918; padding: 15px; border-radius: 50%; color: white; display: inline-flex; align-items: center; justify-content: center; width: 50px; height: 50px; font-size: 1.2em; font-weight: bold;">
                                        @gh[4]
                                    </div>
                                </div>
                                <div class="cart-item-group" style="display: flex; align-items: center; justify-content: space-between; margin-top: 10px;">
                                    <div class="plus-minus-product">
                                        <div class="item-quanlity">
                                            <button type="button" class="item-minus-btn" onclick="updateQuantity('minus', @gh[0])">
                                                <img src="~/Content/Picture/minus.png" class="item-img-minus" />
                                            </button>
                                            <label for="SoLuong">Số lượng:</label>
                                            <input type="number" id="SoLuong-@gh[0]" name="SoLuong" min="1" max="10" value="@gh[2]" placeholder="@gh[2]" onchange="updateTotalPrice()" oninput="updateTotalPrice()" />
                                            <button type="button" class="item-plus-btn" onclick="updateQuantity('plus', @gh[0])">
                                                <img src="~/Content/Picture/plus.png" class="item-img-plus" />
                                            </button>
                                        </div>
                                    </div>
                                    <div>
                                        @gh[8]
                                    </div>
                                    <div class="item-price" style="color: #FF0033; font-weight: bold; margin-left: 20px; font-size: 1.5em;">
                                        @gh[9] VNĐ
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="empty-cart" style="text-align: center; padding: 20px;">
                        <h3>Giỏ hàng của bạn hiện đang trống!</h3>
                        <p>Hãy thêm sản phẩm vào giỏ hàng để bắt đầu mua sắm.</p>
                    </div>
                }
            </div>
        </div>

        <div class="info-pay">
            <form action="/" method="post" class="info-pay__form">
                <h4>Thông tin giỏ hàng</h4>
                <div>
                    <p>Tổng tiền: <input type="number" name="tongtiengh" id="tongtiengh" readonly />
                </div>

                @if (ViewBag.list != null && ViewBag.list.Count > 0)
                {
                    <h4>Thông tin vận chuyển</h4>
                    <div><img src="@Url.Content("~/Content/Picture/profile.jpg")" alt="" /><input type="text" name="name" value="" placeholder="@ViewBag.nd[0][1]" /></div>
                    <div><img src="@Url.Content("~/Content/Picture/phone.jpg")" alt="" /><input type="number" name="phone" value="" placeholder="@ViewBag.nd[0][4]" /></div>
                    <div><img src="@Url.Content("~/Content/Picture/diachi.jpg")" alt="" /><input type="text" name="address" value="" placeholder="@ViewBag.nd[0][5]" /></div>
                }
                else
                {
                    <h4>Thông tin vận chuyển</h4>
                    <div><img src="@Url.Content("~/Content/Picture/profile.jpg")" alt="" /><input type="text" name="name" value="" placeholder="Tên người nhận" /></div>
                    <div><img src="@Url.Content("~/Content/Picture/phone.jpg")" alt="" /><input type="number" name="phone" value="" placeholder="Số điện thoại" /></div>
                    <div><img src="@Url.Content("~/Content/Picture/diachi.jpg")" alt="" /><input type="text" name="address" value="" placeholder="Địa chỉ" /></div>
                }
            </form>
            <div class="info-pay__method-pay">
                <label for="thanh-toan-khi-nhan-hang" class="info-pay__mothod-item">
                    <input type="radio" name="phuong-thanh-toan" value="" id="thanh-toan-khi-nhan-hang" />
                    Thanh toán khi nhận hàng
                </label>
                <label for="thanh-toan-vi" class="info-pay__mothod-item">
                    <input type="radio" name="phuong-thanh-toan" value="" id="thanh-toan-vi" />
                    Thanh toán bằng Ví MeMe
                </label>
                <button type="submit" class="btnthanhtoan" onclick="window.location='@Url.Action("ThanhToan", "Home")'"
                        style="background-color: #FF0033;
                               color: white;
                               border: none;
                               outline: none;
                               border-radius: 8px;
                               padding: 15px 20px;
                               font-size: 18px;
                               font-family: 'Arial', sans-serif;
                               font-weight: bold;
                               cursor: pointer;
                               transition: background-color 0.3s ease;">
                    Thanh toán
                </button>
            </div>
        </div>
    </main>

    <script>
        function updateTotalPrice() {
            let totalAmount = 0;

            document.querySelectorAll('.cart-items').forEach(item => {
                let price = parseFloat(item.querySelector('.item-price').textContent.replace(" VNĐ", "").replace(",", ""));
                let quantity = parseInt(item.querySelector('input[name="SoLuong"]').value);
                totalAmount += (quantity * price);
            });

            document.getElementById('tongtiengh').value = totalAmount.toFixed(0) + ' đ';
        }

        document.addEventListener("DOMContentLoaded", function () {
            updateTotalPrice();

            // Thêm sự kiện onchange và oninput vào tất cả các ô nhập số lượng
            document.querySelectorAll('input[name="SoLuong"]').forEach(input => {
                input.addEventListener("change", updateTotalPrice);
                input.addEventListener("input", updateTotalPrice);
            });
        });
    </script>
</body>
</html>
