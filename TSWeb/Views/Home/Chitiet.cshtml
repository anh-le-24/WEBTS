<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="~/Content/Css/DetailCartStyleSheet.css" rel="stylesheet">
    @{
        Layout = "~/Views/Shared/nav.cshtml";
        System.Collections.ArrayList a = (System.Collections.ArrayList)Session["taikhoan"];
        var userId = a != null && a.Count > 0 ? a[0].ToString() : null; // Đây là ID người dùng (IDND)
    }
</head>
<body>
    <form action="@Url.Action("ThemGH", "Home")" method="post">
        <input value="@userId" name="idnd" type="hidden" />
        <input value="@ViewBag.list[0][0]" name="idsp" type="hidden" />

        <div class="detail-product">
            <img src="~/Content/Picture/profile.jpg" class="detail-product__img" />
            <div class="detail-product__info">
                <h2 class="detail-product__title">@ViewBag.list[0][1]</h2>
                <p class="detail-product__price">Giá : @ViewBag.list[0][2]</p>
                <p class="detail-product__label">Còn hàng</p>

                <div class="sizes">
                    <input type="radio" id="sizeM" name="size" value="M" onchange="updateTotalPrice()" />
                    <label for="sizeM" class="size" data-size="M">M</label>

                    <input type="radio" id="sizeL" name="size" value="L" onchange="updateTotalPrice()" />
                    <label for="sizeL" class="size" data-size="L">L</label>
                </div>

                <label>Chọn Đá:</label><br>
                <input type="radio" id="option1" name="ice" value="Đá ít">
                <label for="option1">Đá ít</label><br>

                <input type="radio" id="option2" name="ice" value="Đá bình thường">
                <label for="option2">Đá bình thường</label><br>

                <input type="radio" id="option3" name="ice" value="Đá nhiều">
                <label for="option3">Đá nhiều</label><br>

                <label>Chọn Đường:</label><br>
                <input type="radio" id="option4" name="sugar" value="Đường ít">
                <label for="option4">Đường ít</label><br>

                <input type="radio" id="option5" name="sugar" value="Đường bình thường">
                <label for="option5">Đường bình thường</label><br>

                <input type="radio" id="option6" name="sugar" value="Đường nhiều">
                <label for="option6">Đường nhiều</label><br>

                <label>Topping:</label>
                <ul style="list-style-type: none;">
                    @foreach (var topping in ViewBag.tp)
                    {
                        <li>
                            <input type="checkbox" id="topping_@topping[0]" name="toppings" value="@topping[1]" data-price="@topping[2]" onchange="updateTotalPrice()">
                            <label for="topping_@topping[0]">@topping[1] giá : @topping[2]</label>
                        </li>
                    }
                </ul>

                <div class="plus-minus-product">
                    <div class="item-quanlity">
                        <button type="button" class="item-minus-btn" onclick="updateQuantity('minus')">
                            <img src="~/Content/Picture/minus.png" class="item-img-minus" />
                        </button>
                        <label for="SoLuong">Số lượng:</label>
                        <input type="number" id="SoLuong" name="SoLuong" min="1" max="10" value="1" placeholder="1" onchange="updateTotalPrice()" />
                        <button type="button" class="item-plus-btn" onclick="updateQuantity('plus')">
                            <img src="~/Content/Picture/plus.png" class="item-img-plus" />
                        </button>
                    </div>
                </div>

                <!-- Lưu chuỗi topping -->
                <input type="text" id="SelectedOptions" name="selectedOptions" value="" />
                <input type="number" name="tongtientp" id="TongTienTopping" value="0"  />

                <label for="TongTien">Tổng tiền:</label>
                <input type="number" id="TongTien" name="TongTien" value="0" placeholder="0" readonly />

                <input type="submit" />
            </div>
        </div>

        <div class="product-description">
            <h3>Mô tả sản phẩm</h3>
            <p>
                @ViewBag.list[0][4]
            </p>
        </div>
    </form>


    <script>
        function updateTotalPrice() {
            let totalPrice = 0;
            let productPrice = parseFloat(document.querySelector('.detail-product__price').textContent.replace('Giá : ', '').replace('₫', '').trim());

            // Cộng giá trị của topping đã chọn
            document.querySelectorAll('input[name="toppings"]:checked').forEach(function (topping) {
                let toppingPrice = parseFloat(topping.getAttribute('data-price'));
                totalPrice += toppingPrice;
            });

            // Cập nhật giá trị của topping vào input
            document.getElementById('TongTienTopping').value = totalPrice.toLocaleString();

            // Cộng giá trị của size (M hoặc L)
            let selectedSize = document.querySelector('input[name="size"]:checked');
            if (selectedSize) {
                let sizePrice = selectedSize.value === 'L' ? 10000 : 0;
                totalPrice += sizePrice;
            }

            // Cập nhật tổng tiền
            let quantity = parseInt(document.getElementById('SoLuong').value);
            let total = (productPrice + totalPrice) * quantity;
            document.getElementById('TongTien').value = total.toLocaleString();
        }

        function updateQuantity(action) {
            let quantityInput = document.getElementById('SoLuong');
            let currentQuantity = parseInt(quantityInput.value);

            if (action === 'plus' && currentQuantity < 20) {
                quantityInput.value = currentQuantity + 1;
            } else if (action === 'minus' && currentQuantity > 1) {
                quantityInput.value = currentQuantity - 1;
            }

            updateTotalPrice();
        }

        // Cập nhật khi người dùng chọn size
        document.querySelectorAll('.size').forEach(function (size) {
            size.addEventListener('click', function () {
                document.querySelectorAll('.size').forEach(function (s) {
                    s.classList.remove('selected');
                });
                size.classList.add('selected');
                updateTotalPrice();
            });
        });

        // Cập nhật các lựa chọn topping, đá, đường
        function getSelectedOptions() {
            let selectedOptions = [];

            // Lấy tất cả các lựa chọn "Đá" đã chọn
            document.querySelectorAll('input[name="ice"]:checked').forEach(function (ice) {
                selectedOptions.push(ice.value);
            });

            // Lấy tất cả các lựa chọn "Đường" đã chọn
            document.querySelectorAll('input[name="sugar"]:checked').forEach(function (sugar) {
                selectedOptions.push(sugar.value);
            });

            // Lấy tất cả topping đã chọn
            document.querySelectorAll('input[name="toppings"]:checked').forEach(function (topping) {
                selectedOptions.push(topping.value);
            });

            // Cập nhật giá trị vào input hidden "SelectedOptions"
            document.getElementById('SelectedOptions').value = selectedOptions.join(", ");
        }

        // Lắng nghe sự kiện khi thay đổi lựa chọn topping, đá, đường
        document.querySelectorAll('input[name="toppings"], input[name="ice"], input[name="sugar"]').forEach(function (option) {
            option.addEventListener('change', getSelectedOptions);
        });

        // Tính toán tổng tiền khi tài liệu được tải xong
        document.addEventListener('DOMContentLoaded', function () {
            updateTotalPrice();
        });
        // Hiển thị topping đã chọn
        document.getElementById('SelectedToppingsDisplay').textContent = selectedToppings.join(", ");

        // Cập nhật giá trị tổng tiền topping vào input hidden và input hiển thị
        document.getElementById('TongTienTopping').value = toppingTotal;
    </script>

</body>
</html>
